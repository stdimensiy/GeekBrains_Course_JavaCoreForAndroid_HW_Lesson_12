### GeekBrains_Course_JavaCoreForAndroid_HW_Lesson_12
---
### Домашняя работа к занятию №12
Студента GeekBrains ***Веремеенко Дмитрия***    
Факультет: ***Android-разработки***    
Курс: ***Java Core для Android***    
### Задание:
---
- [X] ***Задача №1.***     
- a)Создать одномерный длинный массив: static final int SIZE = 10 000 000; static final int HALF = size / 2; float[] arr = new float[size].
- b) Заполнить этот массив единицами.
- с) Засечь время выполнения: long a = System.currentTimeMillis().
- d) Пройти по всему массиву и для каждой ячейки вычислить новое значение по формуле: arr[i] = (float)(arr[i] * Math.sin(0.2f + i / 5) * Math.cos(0.2f + i / 5) * Math.cos(0.4f + i / 2));
- e) Засечь время окончания метода System.currentTimeMillis().
- f) Вывести в консоль время работы программы по обработке массива: System.out.println(System.currentTimeMillis() - a).

                         
- [X] ***Задача №2.***
- a)Создать одномерный длинный массив: static final int SIZE = 10 000 000; static final int HALF = size / 2; float[] arr = new float[size].  
- b) Заполнить этот массив единицами.
- с) Засечь время выполнения: long a = System.currentTimeMillis().
- d) Разбивает массив на два массива.
- e) Организовать и запустить 2 потока каждый из которых выполняет для своей части массива пунет (f).
- f) Пройти по всему массиву и для каждой ячейки вычислить новое значение по формуле: arr[i] = (float)(arr[i] * Math.sin(0.2f + i / 5) * Math.cos(0.2f + i / 5) * Math.cos(0.4f + i / 2));
- g) Соединить ранее разъединенные части массива в один;
- h) Засечь время окончания метода System.currentTimeMillis().
- i) Проверить массивы от первого и от воторго метода на идентичность.
- j) Вывести в консоль время работы программы по обработке второго массива: System.out.println(System.currentTimeMillis() - a).                         
                         
- [X] ***Задача №3.***	*Сделать выводы. Попробовать оптимизировать и еще сократить время выполнения задачи.
   
     
### Отчет о выполнении:
---    
:heavy_check_mark: ***Задача №1.***	Задание выполнено. Для решения поставленной задачи разработаны методы 
startSingleThread(), b fill() последний, сервисный немного упрощающий процесс заполнения массива, немного сокращает код.
Также выполнена подготовка в части оформленияо отчета, подсчета времени, организации необходимого и достаточного 
количества испытаний метода. Дополнительно разработан метод формирующий эталонный массив для валидации результатов 
работы методов в дальнейшем разбивающих исходный массив и собирающих результаты работы обратно в единый.    
:heavy_check_mark: ***Задача №2.***	Задание выполнено. Для решения поставленной задачи, несколько модифицирован метод
startSingleThread(), позволяющий теперь применять его для организации обработки любого массива в режиме многопоточности.
Для организации двух потоков создан новый метод MyThread, посредством которого и производится управление потоками и 
передача необходимых данных для работы потока.
Распределение задач, инициализация и старт потоков производится из метода startTwoThread() который в цикле вызывается 
из модуля организации испытаний и отчетов, находящийся в main класса Lesson12. Согласно заданию, метод разделяет 
передаваемый массив на 2 относительно равные части и обрабатывает каждую в отдельном потоке.
По окончании обработки фрагментов массива каждым из потоков, массивы снова соединяются в один результирующий массив.
Для уверенности, что метод в целом и каждый поток в отдельности корректно выполнили свою задачу, 
Результирующий массив сверяется с эталонным (подготовленным заранее) и только в случае если сверяемые массивы эквивалентны
время затраченное на выполнение работы с массивом (время работы метода) учитывается в очередной итерации испытания.
Итогом серии испытаний, при удовлетворительном результате обработки массивов, является вычисление среднего времени 
выполнения операций обработки массивов в одном потоке и в нескольких потоках соответственно.    
:heavy_check_mark: ***Задача №3.***	 Задание выполнено. Анализируя результаты работы разработанной программы и 
обрабатывая массивы различной длины установленным в задании порядком в одном и в двух потоках соответственно,
можно сделать следующие выводы вывод:    
- При длине массива до 5000 разделение на потоки неэффективно, время на организацию
потоков и сопутствующие операции превышает затраты времени на прямую обработку массива в одном потоке.    
- При длине массива от 5000 до 8000 разделение на потоки нецелесообразно, время на организацию
потоков и сопутствующие сопоставимо затраты времени на прямую обработку массива в одном потоке.
- При длине массива более 10000 элементов разделение задачи на 2 потока начинает иметь хоть какой-то смысл, ибо 
    уменьшение времени на обработку массива 2-мя потоками становится с каждым порядком длины массива все заметнее.    
- Однако замечено, что даже при больших значениях длины массива сокращение времени не может быть более чем в 2
  раза. Для большего сокращения времени требуется изменение алгоритма обработки массива и увеличения количества
  потоков.
  В результате проведения некоторого количества экспериментов с массивом заданной длины 10000000 элементов и формулой
  обработки, из задания, имеющей прямую зависимость от индекса элемента массива (не знаю уловка ли это или просто
  случайность, но задача при таком раскладе стала намного интереснее), выяснилось что с увеличением индекса время
  высчисления каждого последующего элемента массива немного, но растет. Так для элементов с индексами порядка 4-5 млн 
  эта разница накапливается существенно. В итоге (при двух потоках) первый поток в любом случае закончит свою работу
  раньше второго почти в два раза раньше чем второй. В итоге для еще болшей оптимизации процесса многопоточного
  вычисления можно всего навсего поменять отношение первой и второй части массива по длине. 
  В моем ДЗ при заданной длине первоначального массива я поставил отношение 1/3 (т.е первый массив имеет 2/3 общей длины,
  а второй массив всего 1/3) в итоге время выполнения в потоках выровнялось, а среднее время выполнения задачи сократилось
  ориентировочно еще на 20%.
  
В последней версии домашнего задания, вне требований добавлен еще один алгоритм обработки массива.    
Формула сохранена, два потока сохранены, однако убраны разделение и склеивание массивов, как следствие,
проблем со смещением нет, казалось бы код стал проще, и работы процессору меньше. Вместо этого, в отдельном потоке
вызывается метод немного модифицированный метод обработки который на вход принимает исходный массив,
значение стартового индекса и значение приращения итерации. В итоге мы как-бы поручаем двум потокам работать с
одним массивом, как с одной переменной, но избегаем "race condition", ибо каждый из потоков обращается к назначенной 
именно ему ячейке массива, и не влияют друг на друга.
Однако данный способ экспериментально показал свою несостоятельность. Он несомненно быстрее чем обработка массива в 
одном потоке, но дольше чем обработка массива методом дробления исходного массива на более мелкие части и обработке их 
в отдельных потоках с последующим склеиванием.
Где-то видимо я накосорезил...

  
LOG выполнения программы для 3-х вариантов обработки массива (текущая версия программы):    
Подготовка (формирование эталонного массива): ... Готово!    
Тест работы с массивом в режиме одного потока    
⏵ Старт процесса... Испытание №1.Поток:main ✔    
⏸ Стоп  процесса... Испытание №1.Поток:main ✔ / Время выполнения: 18230мс.    
Массивы эквивалентны. ✔    
⏵ Старт процесса... Испытание №2.Поток:main ✔    
⏸ Стоп  процесса... Испытание №2.Поток:main ✔ / Время выполнения: 12566мс.    
Массивы эквивалентны. ✔    
⏵ Старт процесса... Испытание №3.Поток:main ✔    
⏸ Стоп  процесса... Испытание №3.Поток:main ✔ / Время выполнения: 18266мс.    
Массивы эквивалентны. ✔    

Сводный результат тестирования режима "один поток"    
⏱ Среднее время обработки массива 10000000 элементов,    
заданным алгоритмом составляет: 16354 mc.    
+---------------------------------------------------------------------------------------+
Тест работы с массивом в режиме двух потоков с разделением и склеиванием массива    
⏩ Старт многопоточного процесса №1: ✔    
⏵ Старт процесса... Испытание №1.Поток:Thread-0 ✔    
⏵ Старт процесса... Испытание №1.Поток:Thread-1 ✔    
⏸ Стоп  процесса... Испытание №1.Поток:Thread-0 ✔ / Время выполнения: 5693мс.    
⏸ Стоп  процесса... Испытание №1.Поток:Thread-1 ✔ / Время выполнения: 6868мс.    
⏯ Стоп многопоточного процесса №1: ✔    
⏱ Финальное время выполнения: 7004мс.    
Массивы эквивалентны. ✔    
⏩ Старт многопоточного процесса №2: ✔    
⏵ Старт процесса... Испытание №2.Поток:Thread-2 ✔    
⏵ Старт процесса... Испытание №2.Поток:Thread-3 ✔    
⏸ Стоп  процесса... Испытание №2.Поток:Thread-2 ✔ / Время выполнения: 5715мс.    
⏸ Стоп  процесса... Испытание №2.Поток:Thread-3 ✔ / Время выполнения: 6906мс.    
⏯ Стоп многопоточного процесса №2: ✔    
⏱ Финальное время выполнения: 6936мс.    
Массивы эквивалентны. ✔    
⏩ Старт многопоточного процесса №3: ✔    
⏵ Старт процесса... Испытание №3.Поток:Thread-4 ✔    
⏵ Старт процесса... Испытание №3.Поток:Thread-5 ✔    
⏸ Стоп  процесса... Испытание №3.Поток:Thread-4 ✔ / Время выполнения: 5701мс.    
⏸ Стоп  процесса... Испытание №3.Поток:Thread-5 ✔ / Время выполнения: 6863мс.    
⏯ Стоп многопоточного процесса №3: ✔    
⏱ Финальное время выполнения: 6945мс.    
Массивы эквивалентны. ✔    
Сводный результат тестирования режима "Два потока"    
⏱ Среднее время обработки массива 10000000 элементов,    
заданным алгоритмом составляет: 6961 mc.    
+---------------------------------------------------------------------------------------+    
Тест работы с массивом в режиме двух потоков но с модифицированным алгоритмом    
⏩ Старт модифицированного многопоточного процесса №1: ✔    
⏵ Старт процесса... Испытание №1.Поток:Thread-6 ✔    
⏵ Старт процесса... Испытание №1.Поток:Thread-7 ✔    
⏸ Стоп  процесса... Испытание №1.Поток:Thread-6 ✔ / Время выполнения: 9214мс.    
⏸ Стоп  процесса... Испытание №1.Поток:Thread-7 ✔ / Время выполнения: 9214мс.    
⏯ Стоп многопоточного процесса №1: ✔    
⏱ Финальное время выполнения: 9218мс.    
Массивы эквивалентны. ✔    
⏩ Старт модифицированного многопоточного процесса №2: ✔    
⏵ Старт процесса... Испытание №2.Поток:Thread-8 ✔    
⏵ Старт процесса... Испытание №2.Поток:Thread-9 ✔    
⏸ Стоп  процесса... Испытание №2.Поток:Thread-8 ✔ / Время выполнения: 9186мс.    
⏸ Стоп  процесса... Испытание №2.Поток:Thread-9 ✔ / Время выполнения: 9232мс.    
⏯ Стоп многопоточного процесса №2: ✔    
⏱ Финальное время выполнения: 9234мс.    
Массивы эквивалентны. ✔    
⏩ Старт модифицированного многопоточного процесса №3: ✔    
⏵ Старт процесса... Испытание №3.Поток:Thread-10 ✔    
⏵ Старт процесса... Испытание №3.Поток:Thread-11 ✔    
⏸ Стоп  процесса... Испытание №3.Поток:Thread-10 ✔ / Время выполнения: 6421мс.    
⏸ Стоп  процесса... Испытание №3.Поток:Thread-11 ✔ / Время выполнения: 6441мс.    
⏯ Стоп многопоточного процесса №3: ✔    
⏱ Финальное время выполнения: 6442мс.    
Массивы эквивалентны. ✔    
Сводный результат тестирования режима "Два потока"    
⏱ Среднее время обработки массива 10000000 элементов,    
заданным алгоритмом составляет: 8298 mc.    
  
      
---   

*StDimensiy 18.02.2021*
